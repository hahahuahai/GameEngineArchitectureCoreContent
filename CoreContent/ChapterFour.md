# 第四章 游戏所需的三维数学

游戏是在计算机上实时模拟虚拟世界的数学模型。游戏程序员会用到几乎所有数学分支，如三角学、代数、统计学、微积分。然而，游戏程序员最常使用到的是**三维矢量**和**矩阵**。

## 核心知识点

- 矢量
- 矩阵
- 四元数
- 各种旋转表达式
- 其他数学对象
- 随机数

## 详细介绍

### 矢量

1. 概念

矢量（vector）指n维空间中包含**模**和**方向**的量。和矢量相对的概念是**标量**。

2. 矢量在游戏开发中的应用

- 简单的矢量加法，可用来从角色本帧的位置求出次帧的位置。
- 已知两球体的中心点，求两者是否相交。（计算平方根是一个很费时的运算，所以游戏程序员应尽量改用模的平方）
- 单位矢量
- 法矢量
- 点积：点积非常适合用来判断两矢量是否互相共线或垂直，或测试两矢量是否大致在相同或相反方向；判断某个敌人是在玩家的前面还是后面；计算任意一点在某平面上方或下方的高度。
- 叉积：用叉积来求垂直于两个矢量的矢量；求三角形表面或者其他平面的法矢量；计算力矩。
- 矢量投影

### 矩阵

1. 概念

矩阵（matrix）是由m*n个标量组成的长方形数组。矩阵便于线性变换，如**平移（translation）**、**旋转（rotation）**和**缩放（scaling）**。

仿射矩阵（affine matrix）是一种4*4变换矩阵，它能维持直线在变换前后的平行性以及相对的距离比，但不一定维持直线在变幻前后的绝对长度及角度。

单位矩阵（identity matrix）是指，它乘以任何其他矩阵，都会得出和原来一样的矩阵。

逆矩阵（inverse matrix），逆矩阵与原矩阵相乘，结果是单位矩阵。并非所有矩阵都有逆矩阵，若矩阵的逆矩阵存在，则可用*高斯消除法（Gaussian elimination）*或*LU分解（LU decomposition）*求得。

转置矩阵（transpose matrix）就是把原来矩阵以主对角线为对称轴做反射。换句话说，原来矩阵的行变成转置矩阵的列，反之亦然。

齐次坐标：简单来说，原来3 * 3矩阵，没办法把平移、旋转、缩放三个矩阵相乘，浓缩到一个矩阵里面。利用齐次坐标，使得矩阵由原来3 * 3矩阵变成4 * 4矩阵，使得平移、旋转、缩放三个矩阵可以相乘，浓缩到一个矩阵里面。这在游戏开发里面很有用。

2. 坐标空间

- 模型空间。*模型空间的原点*可置于物体的中心位置，如物体的质心，对于人形及动物角色，则可把模型空间的原点置于足部和地面之间。*模型空间的轴*通常会对准模型的自然方向，并会以直觉的标签为这些轴命名。
- 世界空间。世界空间是一个固定坐标空间。游戏世界中所有物体的位置、定向和缩放都会用此空间表示。此坐标空间把所有单个物体联系在一起，形成一个内聚的虚拟世界。
- 观察空间。观察空间原点置于摄像机的焦点。

3. 四元数

